<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="utf-8">
    <meta name="keywords" content="MUFFINS TV - Filmes & Series" />
    <meta name="description" content="MUFFINS TV - Filmes & Series" />
    <meta name="author" content="MUFFINS TV" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Security-Policy" content="worker-src 'self' blob:;">

    <title>MUFFINS TV - Filmes & Series</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="images/favicon.ico">
    <!-- Adicionando o script -->
    <!-- CSS bootstrap-->
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <!-- Estilo -->
    <link rel="stylesheet" href="css/style.css" />
    <!-- Responsivo -->
    <link rel="stylesheet" href="css/responsive.css" />

    <link rel="stylesheet" href="css/loading.css" />
    <link rel="stylesheet" href="css/load.css" />
</head>

<body>
    
    <!--=========== Loader =============-->
    <div id="gen-loading">
        <div id="gen-loading-center">
           <img src="images/logo-1.png" alt="loading">
        </div>
     </div>
    <!--=========== Loader =============-->
    <div class="loader-container">
        <div class="loader"></div>
    </div>
    <!--=========== Loader =============-->
    <div id="error-container" class="error-container" style="display: none;">
      <div class="error-message">
        <span class="error-text"></span>
        <button class="close-button">x</button>
      </div>
    </div>
  
    <div id="success-container" class="success-container" style="display: none;">
      <div class="success-message">
          <span class="success-text">Seu registro foi bem-sucedido!</span>
          <button class="close-button">&times;</button>
      </div>
  </div>

    <!-- Voltar ao Topo -->
    <div id="back-to-top">
        <a class="top" id="top" href="#top"> <i class="ion-ios-arrow-up"></i> </a>
    </div>
    <!-- Voltar ao Topo -->

    <!-- js-min -->
    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/asyncloader.min.js"></script>
    <!-- JS bootstrap -->
    <script src="js/bootstrap.min.js"></script>
    <!-- owl-carousel -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- counter-js -->
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <!-- popper-js -->
    <script src="js/popper.min.js"></script>
    <script src="js/swiper-bundle.min.js"></script>
    <!-- Isotope -->
    <script src="js/isotope.pkgd.min.js"></script>

    <script src="js/jquery.magnific-popup.min.js"></script>

    <script src="js/slick.min.js"></script>

    <script src="js/streamlab-core.js"></script>

    <script src="js/script.js"></script>

    <script src="js/resetpsw.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2091258141429129"
     crossorigin="anonymous"></script>

    <script>
        // Função para capturar parâmetros da URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
        function displayError(message) {
    const errorContainer = document.getElementById('error-container');
    const errorText = errorContainer.querySelector('.error-text');
    const closeButton = errorContainer.querySelector('.close-button');
  
    // Define o texto da mensagem de erro
    errorText.textContent = message;
  
    // Exibe o container de erro
    errorContainer.style.display = 'block';
  
    // Fecha automaticamente após 4 segundos (4000 ms)
    setTimeout(function () {
        errorContainer.style.display = 'none';
    }, 4000);

}

function displaySuccess(message) {
    const successContainer = document.getElementById('success-container');
    const successText = successContainer.querySelector('.success-text');
    successText.textContent = message;
    successContainer.style.display = 'block';
    setTimeout(function () {
        successContainer.style.display = 'none';
    }, 4000);

}

        // Capturar o 'code' e 'email' da URL
        const code = getQueryParam('code');
        const email = getQueryParam('email');

        if (code && email) {
            // Exemplo de integração com a sua API
            fetch(`https://muffins-tv-api-2f0282275534.herokuapp.com/muffins/v1/users/verify-email?code=${code}&email=${email}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.code == 0) {
                    localStorage.setItem('token', data.token)
                    displaySuccess(data.message)
                

                    setTimeout(() => {
                window.location.href = "/index.html";
            }, 2000);
                } else {
                    displayError(data.message)
                    console.log('Erro na verificação:', data.message);
                }
            })
            .catch(error => {
                displayError(data.message)
                console.log('Erro na verificação:', data.message);
            });
        } else {
            displayError(data.message)
            console.log('Erro na verificação:', data.message);
        }

        // Fechar mensagens de erro ou sucesso
        document.querySelectorAll('.close-button').forEach(button => {
            button.addEventListener('click', function() {
                this.parentElement.parentElement.style.display = 'none';
            });
        });
    </script>

</body>

</html>
